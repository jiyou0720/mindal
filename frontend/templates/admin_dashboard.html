<!--frontend/templates/admin_dashboard.html-->
{% extends "base.html" %}

{% block title %}관리자 대시보드 - Mindbridge{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* 새로운 대시보드 레이아웃 스타일 */
        .admin-dashboard-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .dashboard-link-card {
            background-color: #F8FAFC;
            border: 1px solid #E9EEF4;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 180px;
        }

        .dashboard-link-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #007bff;
        }

        .dashboard-link-card i {
            font-size: 3.5em;
            color: #007bff;
            margin-bottom: 20px;
        }

        .dashboard-link-card h3 {
            font-size: 1.6em;
            color: #333;
            margin: 0;
            font-weight: 700;
        }

        .dashboard-link-card p {
            font-size: 0.95em;
            color: #666;
            margin-top: 10px;
            line-height: 1.5;
        }

        /* 기존 사용자 관리 섹션 스타일 (이제 제거됨) */
        /* .admin-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        } */

        @media (max-width: 768px) {
            .admin-dashboard-links {
                grid-template-columns: 1fr;
            }
            .dashboard-link-card {
                padding: 25px;
                min-height: 150px;
            }
            .dashboard-link-card i {
                font-size: 3em;
                margin-bottom: 15px;
            }
            .dashboard-link-card h3 {
                font-size: 1.4em;
            }
            .dashboard-link-card p {
                font-size: 0.9em;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div class="admin-dashboard-container">
        <h1>관리자 대시보드</h1>
        <p>환영합니다, 관리자님! 다음 관리 페이지로 이동할 수 있습니다.</p>
        <p>현재 로그인된 사용자 역할: <span id="currentUserRolesDisplay"></span></p>

        <div class="admin-dashboard-links">
            <a href="{{ url_for('user_management') }}" class="dashboard-link-card"> {# href 변경 #}
                <i class="fas fa-users-cog"></i>
                <h3>사용자 및 권한 관리</h3>
                <p>회원 목록을 조회하고 사용자 역할을 변경하거나 계정을 삭제합니다.</p>
            </a>
            <a href="{{ url_for('menu_management') }}" class="dashboard-link-card">
                <i class="fas fa-bars"></i>
                <h3>메뉴 관리</h3>
                <p>웹사이트 사이드바의 메뉴 항목을 추가, 수정, 삭제합니다.</p>
            </a>
            <a href="{{ url_for('role_menu_assignment') }}" class="dashboard-link-card">
                <i class="fas fa-cogs"></i>
                <h3>권한별 메뉴 설정</h3>
                <p>각 사용자 권한에 따라 메뉴 가시성을 세부적으로 설정합니다.</p>
            </a>
            {# 추가적인 관리 기능 링크를 여기에 추가할 수 있습니다 #}
        </div>

        {# 사용자 관리 섹션 제거 (유지) #}
        {# 역할 관리 모달 제거 (유지) #}

    </div>

    <script>
        // base.html에서 전역으로 선언된 loginUrl, homeUrl, fetchWithAuth 사용

        // 사용자 관리 관련 변수 제거
        // let allUsers = [];
        // let allRoles = []; // 이제 이 페이지에서는 직접 사용하지 않음

        // DOM 요소 가져오기 (사용자 관리 섹션 관련 요소는 제거)
        // const userTableBody = document.getElementById('userTableBody');
        // const noUsersMessage = document.getElementById('noUsersMessage');
        // const userSearchInput = document.getElementById('userSearchInput');
        // const searchUserButton = document.getElementById('searchUserButton');
        const currentUserRolesDisplay = document.getElementById('currentUserRolesDisplay');

        // 역할 관리 모달 관련 요소 제거
        // const roleManagementModal = document.getElementById('roleManagementModal');
        // const closeModalButton = roleManagementModal.querySelector('.close-button');
        // const modalUsername = document.getElementById('modalUsername');
        // const modalUserEmail = document.getElementById('modalUserEmail');
        // const rolesCheckboxesContainer = document.getElementById('rolesCheckboxes');
        // const saveRolesButton = document.getElementById('saveRolesButton');

        // let currentEditingUser = null;

        // 로그인 상태 및 관리자 권한 확인 함수
        async function checkAdminAccess() {
            const token = localStorage.getItem('jwt_token');
            const userRolesString = localStorage.getItem('user_roles');
            let userRoles = [];

            if (!token) {
                alert('관리자 페이지에 접근하려면 로그인이 필요합니다.');
                window.location.href = loginUrl;
                return false;
            }

            if (userRolesString) {
                try {
                    userRoles = JSON.parse(userRolesString);
                } catch (e) {
                    console.error("Error parsing user roles from localStorage:", e);
                    alert('사용자 역할 정보를 불러오는 데 실패했습니다. 다시 로그인해주세요.');
                    localStorage.removeItem('jwt_token');
                    window.location.href = loginUrl;
                    return false;
                }
            }

            // '관리자' 역할이 없으면 접근 제한
            if (!userRoles.includes('관리자')) {
                alert('관리자만 접근할 수 있는 페이지입니다.');
                window.location.href = homeUrl;
                return false;
            }

            currentUserRolesDisplay.textContent = userRoles.join(', ');
            return true;
        }

        // 사용자 관리 섹션과 모달이 제거되었으므로, 관련 함수 호출도 제거합니다.
        /*
        async function fetchAllUsersAndRoles() { ... }
        function renderUserTable(usersToRender) { ... }
        function openRoleManagementModal(userId) { ... }
        closeModalButton.addEventListener('click', () => { ... });
        saveRolesButton.addEventListener('click', async () => { ... });
        async function forceDeleteUser(userId) { ... }
        searchUserButton.addEventListener('click', () => { ... });
        */

        // 초기 로드 시 관리자 접근 권한 확인 후 데이터 로드
        document.addEventListener('DOMContentLoaded', async () => {
            const hasAccess = await checkAdminAccess();
            if (hasAccess) {
                // 사용자 관리 섹션과 모달이 제거되었으므로,
                // fetchAllUsersAndRoles 호출도 제거합니다.
                // fetchAllUsersAndRoles();
            }
        });
    </script>
{% endblock %}
